var spawn = require('child_process').spawn;
var fs = require('fs');


function ffmpeg(cmd, opts, callback) {
    var p = spawn(cmd, opts);

    return p;
}

ffmpeg_var = ffmpeg('..\\ffmpeg\\bin\\ffmpeg.exe', ['-y', '-threads', '-0', '-re', '-rtbufsize', '204800000', '-probesize', '4096', '-vsync', '2', '-async', '30', '-f', 'dshow', '-s', '320x240', '-i', 'video=Integrated Webcam:audio=Microphone Array (IDT High Defi', '-c:a', 'libvo_aacenc', '-ab', '48000', '-ar', '22050', '-ac', '2', '-c:v', 'libx264', '-s', '400x300', '-g', '96', '-x264opts', 'bitrate=1200', '-preset', 'ultrafast', '-profile:v', 'baseline', '-pix_fmt', 'yuv420p', '-aspect', '4:3', '-f', 'mp4', __dirname + '/IntegrityTest.mp4'], function() {

});


var video_source = new Array();
var audio_source = new Array();

/*function failure(e) {
  console.log("Failure");
  alert(e.name)
}*/

function start() {
  MediaStreamTrack.getSources(gotSources);
}

//function gotStream(stream) {
//  console.log("Gotstream");
//  video.src = webkitURL.createObjectURL(stream);
//}

/*function sourceChanged()
{
  var selectList = document.getElementById("sources");

  console.log("Trying to turn on cam: " + sourceIDs[selectList.selectedIndex]);

  //Try to set the video based on this source:
  navigator.webkitGetUserMedia({video: {optional: [{sourceId: videoList.selectedIndex[0].value}]}},
                               gotStream, function() {});
}*/

function gotSources(sourceInfos)
{
  var videoList = document.getElementById("video-list");
  var audioList = document.getElementById("audio-list");

  videoList.options.length = 0;
  audioList.options.length = 0;

  for (var i=0; i < sourceInfos.length; i++) {
    console.log(sourceInfos[i])
    if (sourceInfos[i].kind == 'video') {
      videoList.options.add(new Option(sourceInfos[i].label), sourceInfos[i].id);
    } else if (sourceInfos[i].kind == 'audio') {
      audioList.options.add(new Option(sourceInfos[i].label), sourceInfos[i].id);
    }
  }
}

//video = document.getElementById("videofeed");

//ffmpeg -f dshow -i video="Integrated Webcam":audio="Microphone (High Definition Aud" output.mkv
